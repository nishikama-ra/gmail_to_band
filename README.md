# 西鎌倉住宅地自治会 BAND自動投稿システム (Gmail & 天気予報)

Google Apps Script (GAS) を使用して、**Gmailで受信した特定メール**および**西鎌倉のピンポイント天気予報**を BAND 掲示板へ自動投稿するシステムです。

## 🌟 主な機能

### 1. メール自動転送機能
* **自動検知:** 指定した送信元（鎌倉市、警察、運行情報など）からの未読メールを数分おきにチェックし、BANDへ投稿します。
* **スマート加工:** 配信停止リンクなどの不要なフッターを自動でカットし、読みやすいカスタムヘッダーを付与します。
* **ハッシュタグ:** 内容に応じて `#防犯` などのタグを自動付与し、情報を整理します。
* **添付ファイル:** メール添付ファイルを Google ドライブに自動保存し、共有URLを生成して投稿に記載します。

### 2. 天気予報投稿機能
* **ピンポイント予報:** 西鎌倉交差点付近の3時間ごとの予報（最長36時間先まで）を投稿します。
* **自然な日本語表現:** 「快晴」「晴れ時々曇り」「小雨」など、日本の予報で一般的な用語を使用します。
* **スマホ最適化レイアウト:** 天気の文字数や気温の桁数（氷点下含む）にかかわらず、スマートフォン画面でガタつかない安定したレイアウトで出力します。

## ⚙️ セットアップ手順

### 1. BAND API の準備
1. [BAND Developers](https://developers.band.us/) で `Access Token` を取得します。
2. `Tool.gs` 内の `getBandList()` 関数を実行し、ログ画面から投稿先 BAND の `band_key` を取得します。

### 2. GAS の設定
1. `Config_sample.gs` をコピーして `Config.gs` を作成します。
2. 以下の項目を自身の環境に合わせて書き換えます：
   * `BAND_ACCESS_TOKEN`: 取得したアクセストークン。
   * `TARGET_BAND_KEY`: 投稿先の `band_key`。
   * `IMAGE_FOLDER_ID`: 添付ファイルを保存する Google ドライブのフォルダID。
   * `WEATHER_CONFIG`: 緯度・経度（西鎌倉: 35.322356, 139.502873）や予報件数を設定。

### 3. トリガー設定
GAS エディタの「トリガー」メニューから、以下の関数を登録します。

| 実行関数 | イベントのソース | タイマーの種類 | 間隔・時刻 |
| :--- | :--- | :--- | :--- |
| `checkGmailAndPostToBand` | 時間主導型 | 分ベース | 1分〜5分おき |
| `triggerWeather` | 時間主導型 | 日付ベース | 午前6〜7時、午後6〜7時（1日2回） |

## 📂 ファイル構成

* **Main.gs**: メールスキャンと投稿ロジックのメイン処理。
* **Weather.gs**: 天気情報の取得・整形および投稿処理。
* **Config.gs**: 接続トークン、送信元ルール、天気予報の設定。
* **BandHelper.gs**: BAND API へのリクエスト、ファイル保存処理。
* **Tool.gs**: 初期設定用の BAND 一覧取得機能や統計ツール。
* **Announce.gs**: 自治会ドメインによる API 利用を証明するためのポータル画面。
